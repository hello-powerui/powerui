generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ColorPalette {
  id          String   @id @default(uuid())
  userId      String
  name        String
  description String?
  colors      Json     // Array of hex colors ["#2568E8", "#8338EC", ...]
  isBuiltIn   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isBuiltIn])
  @@index([userId, name])
}

model GeneratedTheme {
  id            String   @id @default(uuid())
  themeId       String
  generatedJson Json     // The complete Power BI theme JSON
  version       String   // Schema version used (e.g., "2.143")
  createdAt     DateTime @default(now())
  
  // Relations
  theme         Theme    @relation(fields: [themeId], references: [id], onDelete: Cascade)

  @@index([themeId, createdAt])
}

model NeutralPalette {
  id          String   @id @default(uuid())
  userId      String?  // Nullable for built-in palettes
  name        String
  shades      Json     // Object with shade values {"25": "#FAFAFA", "50": "#F5F5F5", ...}
  isBuiltIn   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isBuiltIn])
  @@index([userId, name])
}

model Theme {
  id             String           @id @default(uuid())
  userId         String
  name           String
  description    String?
  themeData      Json             // Contains all theme settings
  version        String           @default("2.0") // Theme schema version
  isDefault      Boolean          @default(false)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  
  // Relations
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  generatedThemes GeneratedTheme[]
  
  @@index([userId, createdAt])
}

model User {
  id              String           @id // Clerk user ID
  email           String           @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  
  // Relations
  themes          Theme[]
  colorPalettes   ColorPalette[]
  neutralPalettes NeutralPalette[]
}
